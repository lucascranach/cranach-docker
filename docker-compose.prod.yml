version: '3.2'
services:
  reverse-proxy:
    volumes:
      - ./nginx-config/default.prod.conf:/etc/nginx/conf.d/default.conf:ro
      - /etc/letsencrypt:/etc/letsencrypt
    depends_on:
     - api
     - api-dev
  api:
    environment: 
      - HTTPS=false
      - DOMAIN=${DOMAIN}
  api-dev:
    build: ${PATH_API_DEV}
    command: nodemon app.js
    container_name: cranach-api-dev
    environment: 
      - HTTPS=false
      - DOMAIN=${DOMAIN}
      - ELASTICSEARCH_USERNAME=elastic
      - ELASTICSEARCH_PASSWORD=$ELASTIC_PASSWORD
      - ELASTICSEARCH_INDICES_PREFIX=$ELASTIC_INDICES_PREFIX_DEV
      - API_USERNAME=$API_USERNAME
      - API_PASSWORD=$API_PASSWORD
      - MONGO_DB_CONNECTION_STRING=${MONGO_DB_CONNECTION_STRING}
    image: cranach-api-dev
    volumes:
      - ${PATH_API_DEV}/src:/usr/src/app
      - /usr/src/app/node_modules
      - /etc/letsencrypt:/etc/letsencrypt
    depends_on:
        - elasticsearch
    networks:
      - cranach-network

